<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
    <h:head>
        <title>Election Results</title>
        <style>
            .winner-box {
                background: #d4edda;
                border: 2px solid #28a745;
                padding: 15px;
                border-radius: 5px;
                margin-bottom: 20px;
            }
            .result-table {
                width: 100%;
                border-collapse: collapse;
                margin-top: 10px;
            }
            .result-table th {
                background: #343a40;
                color: white;
                padding: 10px;
                text-align: left;
            }
            .result-table td {
                padding: 8px;
                border-bottom: 1px solid #ddd;
            }
            .result-table tr:hover {
                background: #f5f5f5;
            }
            .election-card {
                border: 1px solid #ddd;
                padding: 15px;
                margin: 10px;
                border-radius: 5px;
                cursor: pointer;
            }
            .election-card:hover {
                background: #f8f9fa;
            }
        </style>
    </h:head>
    <h:body>
        <h:form>
            
            <!-- Header -->
            <div style="background: #007bff; color: white; padding: 20px; text-align: center;">
                <h2>ðŸ“Š Election Results</h2>
                <p>View declared election results</p>
            </div>
            
            <!-- Elections List -->
            <div style="padding: 20px;">
                <h3>Available Results</h3>
                
                <div class="ui-g">
                    <<div>p:repeat</div> value="#{userResultCDIBean.completedElections}" var="election" 
                             styleClass="ui-g-12 ui-md-6 ui-lg-4">
                        <div class="election-card" 
                             onclick="showResult(#{election.electionId})">
                            <h4>#{election.electionName}</h4>
                            <p>Status: #{election.status}</p>
                            <p>Date: #{election.startDate}</p>
                            <p:commandButton value="View Results" 
                                           action="#{userResultCDIBean.showResult(election.electionId)}"
                                           update="resultPanel" 
                                           styleClass="ui-button-primary" />
                        </div>
                    <div></</div>p:repeat>
                </div>
                
                <p:outputPanel rendered="#{empty userResultCDIBean.completedElections}">
                    <div style="text-align: center; padding: 40px; color: #6c757d;">
                        <i class="pi pi-info-circle" style="font-size: 48px;"></i>
                        <h4>No results available</h4>
                        <p>Results will be displayed here once announced.</p>
                    </div>
                </p:outputPanel>
            </div>
            
            <!-- Results Panel -->
            <p:outputPanel id="resultPanel">
                <div style="padding: 20px;" 
                     rendered="#{userResultCDIBean.selectedElection != null}">
                    
                    <!-- Election Title -->
                    <h3>#{userResultCDIBean.selectedElection.electionName} - Results</h3>
                    
                    <!-- Winner Box -->
                    <div class="winner-box">
                        <h4 style="color: #28a745;">
                            <i class="pi pi-trophy"></i> WINNER
                        </h4>
                        <h5>#{userResultCDIBean.winnerName}</h5>
                        <p>Party: #{userResultCDIBean.winnerParty}</p>
                    </div>
                    
                    <!-- Two Column Layout -->
                    <div class="ui-g">
                        
                        <!-- Candidate Results -->
                        <div class="ui-g-12 ui-md-6">
                            <h4>Candidate-wise Results</h4>
                            <table class="result-table">
                                <thead>
                                    <tr>
                                        <th>Rank</th>
                                        <th>Candidate</th>
                                        <th>Party</th>
                                        <th>Votes</th>
                                        <th>%</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <<div>p:repeat</div> value="#{userResultCDIBean.candidateResults}" 
                                             var="candidate" varStatus="status">
                                        <tr style="#{status.index == 0 ? 'background: #d4edda; font-weight: bold;' : ''}">
                                            <td>#{status.index + 1}</td>
                                            <td>#{candidate.candidateName}</td>
                                            <td>#{candidate.partyName}</td>
                                            <td>#{candidate.votes}</td>
                                            <td>#{candidate.percentage}%</td>
                                        </tr>
                                    </p:repeat>
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- Party Results -->
                        <div class="ui-g-12 ui-md-6">
                            <h4>Party-wise Results</h4>
                            <table class="result-table">
                                <thead>
                                    <tr>
                                        <th>Party</th>
                                        <th>Votes</th>
                                        <th>%</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <<div>p:repeat</div> value="#{userResultCDIBean.partyResults}" var="party">
                                        <tr>
                                            <td>#{party.partyName}</td>
                                            <td>#{party.votes}</td>
                                            <td>#{party.percentage}%</td>
                                        </tr>
                                    </<div>p:repeat</div>>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Summary -->
                    <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 5px;">
                        <h5>Summary</h5>
                        <p>Total Votes Cast: 
                           #{userResultCDIBean.candidateResults != null ? 
                             userResultCDIBean.candidateResults.stream()
                                 .mapToInt(c -> c.votes)
                                 .sum() : 0}
                        </p>
                        <p>Total Candidates: 
                           #{userResultCDIBean.candidateResults != null ? 
                             userResultCDIBean.candidateResults.size() : 0}
                        </p>
                    </div>
                    
                </div>
            </p:outputPanel>
            
            <!-- Footer -->
            <div style="text-align: center; padding: 15px; margin-top: 20px; background: #f8f9fa;">
                <p style="color: #6c757d;">
                    Official Results - Election Commission
                </p>
            </div>
            
        </h:form>
        
        <!-- Simple JavaScript -->
        <script>
            function showResult(electionId) {
                // This will be handled by JSF commandButton
            }
        </script>
        
    </h:body>
</html>